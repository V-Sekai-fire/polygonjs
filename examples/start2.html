<!DOCTYPE html>
<html>
	<head>
		<title>Polygonjs Example</title>
		<meta content="width=device-width, initial-scale=1.0" name="viewport" />

		<style>
			html,
			body,
			#app {
				margin: 0px;
				height: 100%;
				overflow: hidden;
			}

			canvas {
				display: block;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<div style="position: fixed; top: 10px; left: 10px; padding:10px; border: 1px solid gray; border-radius: 3px;">
			<p>
				<label>Box Size</label>
				<input id='boxInput' type='range' min=0 max=2 step=0.01 value=1></input>
			</p>
			<p>
				<label>Boxes Count</label>
				<input id="boxesCountInput" type='range' min=0 max=100 step=1 value=10></input>
			</p>
			<p>
				<label>Sphere Size</label>
				<input id='sphereInput' type='range' min=0 max=0.5 step=0.01 value=0.1></input>
			</p>
			<p>
				<label>Spheres Count</label>
				<input id='spheresCountInput' type='range' min=0 max=1000 step=1 value=400></input>
			</p>
		</div>
		<div id="app"></div>

		<script type="module">
			import {PolyScene} from 'https://unpkg.com/@polygonjs/polygonjs@latest/dist/all.js';
			// create a scene
			const scene = new PolyScene();
			const rootNode = scene.root();

			// create a geo node to add the geometry nodes we will need
			const geo = rootNode.createNode('geo');

			// create a plane
			const plane = geo.createNode('plane');
			plane.p.size.set([10, 10]); // make the plane larger
			plane.p.stepSize.set(0.1); // increase the plane resolution

			// add noise to the plane
			const noise = geo.createNode('noise');
			noise.setInput(0, plane);
			noise.p.amplitude.set(0.25); // lower the noise amount
			noise.p.useNormals.set(1); // have the noise in the direction of the normals

			// scatter points on the plane
			const scatter = geo.createNode('scatter');
			scatter.setInput(0, noise);
			scatter.p.pointsCount.set(10);

			// copy boxes on the points
			const box = geo.createNode('box');
			const copy = geo.createNode('copy');
			copy.setInput(0, box);
			copy.setInput(1, scatter);

			// add a 2nd scatter to create points on the boxes
			const scatter2 = geo.createNode('scatter');
			scatter2.setInput(0, copy);
			scatter2.p.pointsCount.set(500);

			// copy spheres on those points
			const sphere = geo.createNode('sphere');
			sphere.p.resolution.set([8, 8]);
			sphere.p.radius.set(0.1);
			const copy2 = geo.createNode('copy');
			copy2.setInput(0, sphere);
			copy2.setInput(1, scatter2);
			copy2.flags.display.set(true);

			// add a light
			rootNode.createNode('hemisphereLight');

			// create a camera
			const perspectiveCamera1 = rootNode.createNode('perspectiveCamera');
			perspectiveCamera1.p.t.set([5, 5, 5]);
			// add OrbitControls
			const events1 = perspectiveCamera1.createNode('eventsNetwork');
			const orbitsControls = events1.createNode('cameraOrbitControls');
			perspectiveCamera1.p.controls.setNode(orbitsControls);

			perspectiveCamera1.createViewer(document.getElementById('app'));

			// add events to the inputs
			document.getElementById('boxInput').addEventListener('input', function (event) {
				box.p.size.set([event.target.value, event.target.value]);
			});
			document.getElementById('boxesCountInput').addEventListener('input', function (event) {
				scatter.p.pointsCount.set(event.target.value);
			});
			document.getElementById('sphereInput').addEventListener('input', function (event) {
				sphere.p.radius.set(event.target.value);
			});
			document.getElementById('spheresCountInput').addEventListener('input', function (event) {
				scatter2.p.pointsCount.set(event.target.value);
			});
		</script>
	</body>
</html>
